

pdf(file='./monperrusdata/literate_mcmc_logs/papers_BD_RTT_plots.pdf',width=12, height=8)
par(mfrow=c(2,4))
usePackage <- function(p){if (!is.element(p, installed.packages()[,1])) install.packages(p, dep = TRUE, repos='https://cloud.r-project.org'); library(p, character.only = TRUE)}
usePackage('scales')

###papers_BD_mcmc###

#Number Shifts
unique=c(3.0, 4.0,5.0,6.0)
counts=c(212, 516,68,4)
plot(unique,counts,type = 'h', xlim = c(0,7.0), ylab = 'Frequency', xlab = 'n. shifts',lwd=5,col='#4c4cec')
#Birth rate Plot
time=c(2002.5, 2003.5,2004.5,2005.5,2006.5,2007.5,2008.5,2009.5,2010.5,2011.5,2012.5,2013.5,2014.5,2015.5,2016.5,2017.5,2018.5,2019.5,2020.5,2021.5,2022.5,2023.5,2024.5)
birth_rate=c(0.22811947977662597, 0.2291466382830054,0.22973112317000613,0.2298319683767067,0.22945627002051958,0.22787114368029646,0.22763600227831804,0.22744080257358315,0.22564747568348625,0.22436020367827123,0.2228108585950227,0.2223782999597838,0.22202141216230598,0.22156449785815802,0.22138277209118415,0.22157384299494431,0.22161760389899945,0.2182162539359006,0.16635864523300026,0.16600749011132848,0.1659677904175342,0.08375890991906614,0.006034959294896519)
birth_minHPD=c(0.15416422334655736, 0.1684844483495224,0.1791298933735892,0.1791298933735892,0.17974162025600077,0.1791298933735892,0.1822745339724081,0.1822745339724081,0.18328519008343677,0.18344110549954348,0.18163304544459277,0.18163304544459277,0.18163304544459277,0.18128710911699206,0.18143358082677336,0.18143358082677336,0.18128710911699206,0.16973324689804076,0.1296781910779191,0.13184748915345487,0.13184748915345487,0.053833398072418825,0.00030301281545439424)
birth_maxHPD=c(0.30054983268859214, 0.2914127089960759,0.2914127089960759,0.27094612253706435,0.27094612253706435,0.2674600064454842,0.26835169309553597,0.26835169309553597,0.2644638326783018,0.2623737646189121,0.25807771840435806,0.2558413722831568,0.2551112767149007,0.2546677617460269,0.25519479795332445,0.2558413722831568,0.2558413722831568,0.2608360283917067,0.20787972701552784,0.20765720932567983,0.20787972701552784,0.1439613437029658,0.01479398699757367)
plot(time,time,type = 'n', ylim = c(0, 0.3306048159574514), xlim = c(2002.0,2025.5), ylab = 'Birth rate', xlab = 'Time (AD)',main='papers_BD_mcmc' )
polygon(c(time, rev(time)), c(birth_maxHPD, rev(birth_minHPD)), col = alpha('#4c4cec',0.3), border = NA)
lines(time,birth_rate, col = '#4c4cec', lwd=2)
#Frequency of shifts
birth_counts=c(0.0, 0.0175,0.0075,0.0175,0.00625,0.01,0.005,0.0075,0.01875,0.01625,0.01625,0.01,0.01,0.00625,0.005,0.0025,0.00625,0.06375,0.6875,0.015,0.00125,0.90125,0.99875)
plot(time,birth_counts,type = 'h', xlim = c(2002.0,2025.5), ylim=c(0,0.99875), ylab = 'Frequency of rate shift', xlab = 'Time (AD)',lwd=5,col='#4c4cec')
bf2 = 0.08776040779875822
bf6 = 0.4154956195462569
abline(h=bf2, lty=2)
abline(h=bf6, lty=2)
birth_BF2=as.numeric(c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA))
birth_BF6=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.16635864523300026,NA,NA,0.08375890991906614,0.006034959294896519)
#Net Rate
net_rate=c(0.21151512162162117, 0.21520071367723814,0.218128225615078,0.2210578232998202,0.22192634943546616,0.22164089490022698,0.22171101847823954,0.22192084399943596,0.2201446751614278,0.21890882845827528,0.21737597207058276,0.21693713659743072,0.21658024879995288,0.2161156008810816,0.21593387511410775,0.21612494601786789,0.21615710147037853,0.21275575150727977,0.16077933763577668,0.14318596162144479,0.1278886789739073,-0.09787814352820813,-0.17560209415237776)
net_minHPD=c(0.07891808013135918, 0.1332633441925148,0.12179118643839107,0.1680020371503263,0.1680020371503263,0.17045249120409378,0.1746463202270827,0.1746463202270827,0.1761008763033394,0.17723747560722666,0.1746463202270827,0.1746463202270827,0.1761008763033394,0.17690392028301857,0.1761008763033394,0.17469567034950848,0.17690392028301857,0.162797995600864,0.12405074815482263,0.09710166653901289,0.08607059634768012,-0.1527207182583713,-0.20804249949656595)
net_maxHPD=c(0.29644870234276743, 0.33789303935425846,0.29644870234276743,0.29644870234276743,0.27800407930504695,0.26267856154229313,0.26267856154229313,0.26181042386836123,0.25862952235493525,0.2574771402221932,0.2516178131176976,0.24884083418706485,0.24884083418706485,0.24884083418706485,0.24884083418706485,0.24865352957781528,0.25200605675057464,0.25392319418974585,0.20269651835235322,0.1923632468816126,0.1719045684162582,-0.039517553800049954,-0.145111932100934)
plot(time,time,type = 'n', ylim = c(-0.22884674944622255, 0.37168234328968436), xlim = c(2002.0,2025.5), ylab = 'Net Rate', xlab = 'Time (AD)',lwd=2, main='', col= '#32CD32' )
polygon(c(time, rev(time)), c(net_maxHPD, rev(net_minHPD)), col = alpha('#32CD32',0.3), border = NA)
lines(time,net_rate, col = '#32CD32', lwd=2)
abline(h=0,lty=2)

#Number Shifts
unique=c(3.0, 4.0,5.0)
counts=c(658, 136,6)
plot(unique,counts,type = 'h', xlim = c(0,7.0), ylab = 'Frequency', xlab = 'n. shifts',lwd=5,col='#e34a33')
#Death rate Plot
time=c(2002.5, 2003.5,2004.5,2005.5,2006.5,2007.5,2008.5,2009.5,2010.5,2011.5,2012.5,2013.5,2014.5,2015.5,2016.5,2017.5,2018.5,2019.5,2020.5,2021.5,2022.5,2023.5,2024.5)
death_rate=c(0.016604358155004544, 0.013945924605766886,0.011602897554927837,0.008774145076886205,0.007529920585053109,0.0062302487800692365,0.00592498380007824,0.005519958574146907,0.0055028005220583,0.00545137521999579,0.0054348865244398,0.00544116336235299,0.00544116336235299,0.0054488969770762905,0.0054488969770762905,0.0054488969770762905,0.005460502428620862,0.005460502428620862,0.005579307597223638,0.02282152848988369,0.03807911144362681,0.18163705344727443,0.18163705344727443)
death_minHPD=c(0.00043457833164185945, 0.00043457833164185945,0.00043457833164185945,0.0007336243167337667,0.0007336243167337667,0.0014105804643835612,0.0015568199819346014,0.0018866974531488482,0.0018866974531488482,0.0018866974531488482,0.0015568199819346014,0.001561944241291052,0.001561944241291052,0.0016009197664587824,0.0016009197664587824,0.0016009197664587824,0.0015568199819346014,0.0015568199819346014,0.0019356291357277397,0.002807917968155645,0.021111654703311195,0.1513187058789747,0.1513187058789747)
death_maxHPD=c(0.08297918080110817, 0.06645252814131847,0.05479213199507368,0.025334312244886463,0.012754476072880078,0.010749569077822681,0.010660920495225254,0.010660920495225254,0.010598949516069748,0.010536498992335528,0.010148129072097336,0.010148129072097336,0.010148129072097336,0.010148129072097336,0.010148129072097336,0.010148129072097336,0.010060706839946894,0.010060706839946894,0.010598949516069748,0.04211330250881609,0.05947346999952148,0.2125324207363542,0.2125324207363542)
plot(time,time,type = 'n', ylim = c(0, 0.23378566280998964), xlim = c(2002.0,2025.5), ylab = 'Death rate', xlab = 'Time (AD)',main='' )
polygon(c(time, rev(time)), c(death_maxHPD, rev(death_minHPD)), col = alpha('#e34a33',0.3), border = NA)
lines(time,death_rate, col = '#e34a33', lwd=2)
#Frequency of shifts
death_counts=c(0.0, 0.0275,0.02375,0.03625,0.0225,0.02375,0.01125,0.01125,0.0025,0.005,0.00375,0.00125,0.0,0.00125,0.0,0.0,0.00375,0.0,0.01,0.60625,0.395,1.0,0.0)
plot(time,death_counts,type = 'h', xlim = c(2002.0,2025.5), ylim=c(0,1.0), ylab = 'Frequency of rate shift', xlab = 'Time (AD)',lwd=5,col='#e34a33')
abline(h=bf2, lty=2)
abline(h=bf6, lty=2)
death_BF2=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.03807911144362681,0.18163705344727443,NA)
death_BF6=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.02282152848988369,NA,0.18163705344727443,NA)
#Net Diversity
net_diversity=c(1.0, 2.0,2.0,4.0,7.0,9.0,13.0,20.0,27.0,36.0,44.0,56.0,71.0,92.0,109.5,141.0,192.0,246.0,284.5,334.0,391.5,394.5,328.0)
plot(time,net_diversity,type = 'l', ylab = 'Net Diversity', xlab = 'Time (AD)',lwd=2, main='', col= '#32CD32' )


#PRETTY PLOT
usePackage <- function(p){
if (!is.element(p, installed.packages()[,1]))
install.packages(p, dep = TRUE, repos='https://cloud.r-project.org')
require(p, character.only = TRUE)}
usePackage('ggplot2')

emp_birth=c(NA, 0.5,0.0,0.5,0.42857142857142855,0.2222222222222222,0.3076923076923077,0.35,0.25925925925925924,0.25,0.18181818181818182,0.21428571428571427,0.2112676056338028,0.22826086956521738,0.1643835616438356,0.22695035460992907,0.2708333333333333,0.22357723577235772,0.13708260105448156,0.15868263473053892,0.17624521072796934,0.07604562737642585,0.0)
emp_death=c(NA, 0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0091324200913242,0.0,0.010416666666666666,0.0,0.0035149384885764497,0.017964071856287425,0.04342273307790549,0.09378960709759189,0.2926829268292683)
rates.dat=data.frame(time,emp_birth,emp_death,birth_rate,birth_minHPD,birth_maxHPD,birth_BF2,birth_BF6,death_minHPD,death_maxHPD,death_BF2,death_BF6)
ggplot(rates.dat, aes(time,birth_rate)) +
        geom_line(size=.7,col='blue') +
        geom_line(aes(time,death_rate),col='red',size=.7) +
         scale_color_manual(values = c('blue','red')) +
        scale_x_continuous(breaks=seq(time[1]-time[1]%%-5,time[length(time)]-time[length(time)]%%-5,5),minor_breaks=seq(time[1]-time[1]%%-5,time[length(time)]-time[length(time)]%%-5,1)) +
        scale_y_continuous(breaks=seq(0.0,0.5,.1),limits = c(0.0,0.5)) + 
        geom_ribbon(aes_string(ymin=birth_minHPD,ymax=birth_maxHPD,fill=shQuote('red')),alpha=.2,col=NA)+ 
        geom_ribbon(aes_string(ymin=death_minHPD,ymax=death_maxHPD,fill=shQuote('blue')),alpha=.2,col=NA)+
        geom_line(aes(time,emp_birth,col='eb'),size=.5,linetype = 'dashed')+
        geom_line(aes(time,emp_death,col='ed'),size=.5,linetype = 'dashed')+
        geom_point(aes(time,birth_BF2), size = 1, alpha=1,col='yellow') +
        geom_point(aes(time,birth_BF6), size = 2, alpha=1,col='yellow') +
        geom_point(aes(time,death_BF2), size = 1, alpha=1,col='yellow') +
        geom_point(aes(time,death_BF6), size = 2, alpha=1,col='yellow') +
        theme(legend.position = 'none')+
        labs(x='Time',y='Rates')




n <- dev.off()